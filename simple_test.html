<!DOCTYPE html>
<html>
  <head>
    <title>Simple Edit Form Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .form-group {
        margin: 10px 0;
      }
      label {
        display: inline-block;
        width: 150px;
      }
      input,
      select,
      textarea {
        width: 200px;
        padding: 5px;
      }
      .debug {
        background: #f0f0f0;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
    </style>
  </head>
  <body>
    <h1>Simple Student Edit Form Test</h1>

    <div class="debug">
      <h3>Test Steps:</h3>
      <button onclick="testAjax()">1. Test AJAX Call</button>
      <button onclick="populateForm()">2. Populate Form</button>
      <button onclick="checkValues()">3. Check Form Values</button>
    </div>

    <div id="results"></div>

    <form id="editForm">
      <div class="form-group">
        <label>Student ID:</label>
        <input type="text" id="edit_student_id" readonly />
      </div>
      <div class="form-group">
        <label>Name:</label>
        <input type="text" id="edit_name" />
      </div>
      <div class="form-group">
        <label>Email:</label>
        <input type="email" id="edit_email" />
      </div>
      <div class="form-group">
        <label>Age:</label>
        <input type="number" id="edit_age" />
      </div>
      <div class="form-group">
        <label>Gender:</label>
        <select id="edit_gender">
          <option value="">Select Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
      </div>
      <div class="form-group">
        <label>Class Level:</label>
        <input type="text" id="edit_class_level" />
      </div>
      <div class="form-group">
        <label>Academic Year:</label>
        <input type="text" id="edit_academic_year" />
      </div>
      <div class="form-group">
        <label>Phone:</label>
        <input type="text" id="edit_phone" />
      </div>
      <div class="form-group">
        <label>Address:</label>
        <textarea id="edit_address" rows="3"></textarea>
      </div>
      <div class="form-group">
        <label>Graduation Status:</label>
        <select id="edit_graduation_status">
          <option value="Enrolled">Enrolled</option>
          <option value="Graduated">Graduated</option>
          <option value="Dropped Out">Dropped Out</option>
        </select>
      </div>
    </form>

    <script>
      let studentData = null;

      function testAjax() {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '<p>Testing AJAX...</p>';

        fetch('index.php?ajax=get_student&id=18')
          .then((response) => {
            console.log('Response status:', response.status);
            console.log('Response headers:', response.headers);
            return response.text();
          })
          .then((text) => {
            console.log('Raw response:', text);
            resultsDiv.innerHTML += '<h4>Raw AJAX Response:</h4><pre>' + text + '</pre>';

            try {
              studentData = JSON.parse(text);
              console.log('Parsed data:', studentData);
              resultsDiv.innerHTML += '<div class="success">✅ AJAX successful</div>';
              resultsDiv.innerHTML +=
                '<h4>Parsed Data:</h4><pre>' + JSON.stringify(studentData, null, 2) + '</pre>';
            } catch (e) {
              console.error('JSON parse error:', e);
              resultsDiv.innerHTML +=
                '<div class="error">❌ JSON Parse Error: ' + e.message + '</div>';
            }
          })
          .catch((error) => {
            console.error('Fetch error:', error);
            resultsDiv.innerHTML += '<div class="error">❌ AJAX Error: ' + error + '</div>';
          });
      }

      function populateForm() {
        const resultsDiv = document.getElementById('results');

        if (!studentData) {
          resultsDiv.innerHTML +=
            '<div class="error">❌ No student data. Run AJAX test first.</div>';
          return;
        }

        resultsDiv.innerHTML += '<h4>Populating Form:</h4>';

        const fieldMappings = {
          edit_student_id: studentData.id,
          edit_name: studentData.name,
          edit_email: studentData.email,
          edit_age: studentData.age,
          edit_gender: studentData.gender,
          edit_class_level: studentData.class_level,
          edit_academic_year: studentData.academic_year,
          edit_phone: studentData.phone,
          edit_address: studentData.address,
          edit_graduation_status: studentData.graduation_status,
        };

        let log = [];
        for (const [fieldId, value] of Object.entries(fieldMappings)) {
          const element = document.getElementById(fieldId);
          if (element) {
            const oldValue = element.value;
            element.value = value || '';
            log.push(`✅ ${fieldId}: "${oldValue}" → "${element.value}"`);
          } else {
            log.push(`❌ ${fieldId}: Element not found!`);
          }
        }

        resultsDiv.innerHTML += '<pre>' + log.join('\n') + '</pre>';
      }

      function checkValues() {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML += '<h4>Current Form Values:</h4>';

        const fields = [
          'edit_student_id',
          'edit_name',
          'edit_email',
          'edit_age',
          'edit_gender',
          'edit_class_level',
          'edit_academic_year',
          'edit_phone',
          'edit_address',
          'edit_graduation_status',
        ];

        let log = [];
        fields.forEach((fieldId) => {
          const element = document.getElementById(fieldId);
          if (element) {
            log.push(`${fieldId}: "${element.value}"`);
          } else {
            log.push(`${fieldId}: NOT FOUND`);
          }
        });

        resultsDiv.innerHTML += '<pre>' + log.join('\n') + '</pre>';
      }
    </script>
  </body>
</html>
