<!DOCTYPE html>
<html>
  <head>
    <title>AJAX Test</title>
  </head>
  <body>
    <h1>Testing KPI AJAX Endpoint</h1>

    <button onclick="testAllYears()">Test All Years</button>
    <button onclick="testYear1()">Test Year 1</button>
    <button onclick="testYear2()">Test Year 2</button>

    <div id="results" style="margin-top: 20px; padding: 10px; background: #f0f0f0"></div>

    <script>
      function testKPI(year, description) {
        console.log(`Testing ${description}...`);
        document.getElementById('results').innerHTML = `<h3>Testing ${description}...</h3>`;

        fetch('index.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: 'ajax=get_kpis&filter_year=' + encodeURIComponent(year),
        })
          .then((response) => {
            console.log('Response status:', response.status);
            console.log('Response headers:', response.headers.get('content-type'));
            return response.text();
          })
          .then((text) => {
            console.log('Raw response:', text);
            document.getElementById('results').innerHTML = `
                    <h3>${description} Results:</h3>
                    <h4>Raw Response:</h4>
                    <pre style="background: white; padding: 10px; border: 1px solid #ccc;">${text}</pre>
                `;

            try {
              const data = JSON.parse(text);
              console.log('Parsed JSON:', data);
              document.getElementById('results').innerHTML += `
                        <h4>Parsed JSON:</h4>
                        <pre style="background: white; padding: 10px; border: 1px solid #ccc;">${JSON.stringify(
                          data,
                          null,
                          2
                        )}</pre>
                    `;
            } catch (e) {
              console.error('JSON parse error:', e);
              document.getElementById('results').innerHTML += `
                        <h4 style="color: red;">JSON Parse Error:</h4>
                        <p style="color: red;">${e.message}</p>
                    `;
            }
          })
          .catch((error) => {
            console.error('Fetch error:', error);
            document.getElementById('results').innerHTML += `
                    <h4 style="color: red;">Fetch Error:</h4>
                    <p style="color: red;">${error.message}</p>
                `;
          });
      }

      function testAllYears() {
        testKPI('', 'All Years');
      }

      function testYear1() {
        testKPI('1', 'Year 1 Only');
      }

      function testYear2() {
        testKPI('2', 'Year 2 Only');
      }
    </script>
  </body>
</html>
